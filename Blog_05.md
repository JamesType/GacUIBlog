# GacUI：高效的布局系统 (2)

## 背景

上一篇文章 [高效的布局系统](./Blog_03.md) 到现在已经过去了三年，GacUI 的布局系统如今有了一个较大的翻新，主要是在实现上。

上一个版本的布局算法已经几乎实现了布局的局部刷新，以及按需触发布局的更新。但是依然存在着一个问题，就是布局的循环依赖。循环依赖的存在是需求导致的。比如`<SharedSizeRoot>`包含`<SharedSizeItem>`，但是同一个root下的item会互相同步尺寸。比如`<ResponseiveContainer>`包含各种responsive view，但是responsive view会因为container的大小的变化而改变自己的形状。循环依赖是不可能去掉的，但是实现上有一个问题，就是`GetBounds`函数既要触发可能的布局刷新，而且布局的刷新也依赖其他composition的`GetBounds`，这样调用来调用去就容易出问题。这个问题需要解决。

另一个问题则出现在列表控件的列表项布局上。熟悉GacUI的朋友们可能会意识到`GuiListControl`的ItemArranger属性，其实就是另一套布局，只不过是针对循环出现的对象以及生命周期的控制的。这样的设计的问题，就在于很难精准判断列表的布局什么时候应该发生。而且对于下拉列表，下拉的菜单大小跟列表项的大小是有关的，而且列表项的大小也是跟下拉菜单的大小有关的，这也形成了循环依赖，在实现上容易出问题。当然这个循环依赖依然是需求决定的，只能从实现入手。

最后一个问题则在于data binding，虽然GacUI不鼓励把data binding应用在尺寸上，但是有的时候确实是没办法。这样也会创建我作为GacUI的作者完全不可预知的循环依赖，搞不好容易因为使用者的data binding写得不好而出现死循环，对于使用者来说这显然是一个难以debug的问题。

那有没有可能从根本上解决这些麻烦呢？

## 改变



## 尾声